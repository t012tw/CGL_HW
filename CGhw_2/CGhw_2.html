<html>
<body style = "overflow: hidden;">

<p id = title style = "position: absolute;top: 1%;" >Tank</p>
</body>
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/84/three.min.js"></script>
<script src="https://threejs.org/examples/js/controls/OrbitControls.js"></script>
<script src="https://jyunming-chen.github.io/tutsplus/js/KeyboardState.js"></script>
<script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
</html>

<script>
var renderer, camera, controls, scene;
var base_ob = new THREE.Object3D();
var fort_ob = new THREE.Object3D();
var barrel1_ob = new THREE.Object3D();
var barrel2_ob = new THREE.Object3D();
var angle_base = 0, angle_fort = 0, angle_barrel1 = 0;
var keyboard = new KeyboardState();

init();
animate();

function init() {

  renderer = new THREE.WebGLRenderer();
  renderer.setSize(window.innerWidth, window.innerHeight);
  renderer.setClearColor(0x888888);
  document.body.appendChild(renderer.domElement);
  camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 1, 1000);
  camera.position.set( 100, 100, -50);
	camera.lookAt(new THREE.Vector3(10,10,10));//It's still not work,and I still don't know why.
  controls = new THREE.OrbitControls(camera, renderer.domElement);
  scene = new THREE.Scene();
  
  var base = new THREE.Mesh(new THREE.BoxGeometry(40, 10, 20), new THREE.MeshNormalMaterial);
  var fort = new THREE.Mesh(new THREE.CylinderGeometry(10, 10, 10, 32 ), new THREE.MeshNormalMaterial);
  var barrel1 = new THREE.Mesh(new THREE.CylinderGeometry(1.5, 1.5, 10, 32 ), new THREE.MeshNormalMaterial);
  var barrel2 = new THREE.Mesh(new THREE.CylinderGeometry(1.5, 1.5, 10, 32 ), new THREE.MeshNormalMaterial);
  
  base_ob.add(base);
  fort_ob.add(fort);
  barrel1_ob.add(barrel1);
  barrel2_ob.add(barrel2);
  
  base_ob.add(fort_ob);
  fort_ob.add(barrel1_ob);
  barrel1_ob.add(barrel2_ob);
  
  fort_ob.position.x -= 10;
  fort_ob.position.y += 10;
  barrel1_ob.position.x -= 10;
  barrel1_ob.rotation.x += Math.PI/2;
  barrel2_ob.position.x -= 5;
  barrel2_ob.rotation.z += Math.PI/2;
	scene.add(base_ob);
  
  var gridXZ = new THREE.GridHelper(200, 20, 'red', 'white');
  scene.add(gridXZ);

  window.addEventListener('resize', onWindowResize, false);
}

function animate() {

  controls.update();
  keyboard.update();
  
  if (keyboard.pressed ('A') && keyboard.pressed ('S')) {
  	angle_base -= 0.02;
  } else if (keyboard.pressed ('A')) {
  	angle_base += 0.02;
  }
  if (keyboard.pressed ('D') && keyboard.pressed ('S')) {
  	angle_base += 0.02;
  } else if (keyboard.pressed ('D')) {
  	angle_base -= 0.02;
  }
  if (keyboard.pressed ('J')) {
  	angle_fort += 0.02;
  }
  if (keyboard.pressed ('L')) {
  	angle_fort -= 0.02;
  }
  if (keyboard.pressed ('K')) {
      if(angle_barrel1 < Math.PI/6) angle_barrel1 += 0.01;
  }
  if (keyboard.pressed ('I')) {
  		if(angle_barrel1 > -Math.PI/6) angle_barrel1 -= 0.01;
  }
  if (keyboard.pressed ('W')) {
      base_ob.position.x -= 0.8*Math.cos(angle_base);
      base_ob.position.z += 0.8*Math.sin(angle_base);
  }
  if (keyboard.pressed ('S')) {
  		base_ob.position.x += 0.8*Math.cos(angle_base);
      base_ob.position.z -= 0.8*Math.sin(angle_base);
  }
  
  base_ob.rotation.y = angle_base;
  fort_ob.rotation.y = angle_fort;
  barrel1_ob.rotation.y = angle_barrel1;
  requestAnimationFrame(animate);
  renderer.render(scene, camera);  
}


function onWindowResize() {

  var width = window.innerWidth;
  var height = window.innerHeight;
  camera.aspect = width / height;
  camera.updateProjectionMatrix();
  renderer.setSize(width, height);
}

</script>